Virtuozzo 7 Installation Guide
==============================
:doctype: book

Introduction
------------

Virtuozzo 7 is a virtualization solution that allows you to run multiple virtual machines and containers on a single physical server.

This chapter provides general information about Virtuozzo and this guide.

[options="compact"]
* Virtuozzo basics
* goals and target
* guide organization
* resources to consult to get more information on Virtuozzo
* ways to submit feedback to the Odin documentation team
 
About Virtuozzo 7
~~~~~~~~~~~~~~~~~

Virtuozzo 7 is a virtualization solution that allows you to simultaneously run multiple virtual machines and containers on a single physical server. With Virtuozzo, you can efficiently share your server's hardware resources among virtual machines and containers.

Virtuozzo is installed directly on the server hardware and does not need any operating system to function. Once it is installed, Virtuozzo allows you to create virtual machines and containers and manage them using the following tools:

[options="compact"]
* *Command-line interface (CLI)*. The command-line interface comprises a set of command-line utilities that you can use to manage virtual machines and containers, both locally and remotely.
* *Virtual Automation (VA)*. Virtual Automation is a remote management tool that allows you to manage physical servers and their virtual machines and containers with the help of a standard Web browser on any platform.

Graphically, a server with the Virtuozzo software installed can be represented as follows:

image::images/psbm55_architecture.png[align="center"]

About This Guide
~~~~~~~~~~~~~~~~

The _Virtuozzo 7 Installation Guide_ provides detailed information on installing Virtuozzo on a physical server.

This guide is intended for anyone interested in installing and putting Virtuozzo in operation on their servers.

Organization of This Guide
^^^^^^^^^^^^^^^^^^^^^^^^^^

This guide is organized in the following way:

<<_introduction>>, gives an overview of the Virtuozzo product and this guide.

<<_preparing_for_installation>>, describes the hardware and software requirements a physical server must meet to successfully install Virtuozzo.

<<_installing_virtuozzo_7>>, provides detailed information on installing Virtuozzo on a physical server.

<<_exploring_additional_installation_options>>, explains how to create software RAIDs, boot into rescue mode, and configure Virtuozzo to run in virtual machines.

<<_starting_to_work_in_virtuozzo_7>>, instructs you how to set up Virtual Automation, a web-based tool for managing virtual machines and containers.

Getting Help
~~~~~~~~~~~~

In addition to this guide, you can use the following resources to learn how to work in Virtuozzo.

* _Getting Started With Virtuozzo 7_. This guide provides basic information on installing Virtuozzo on a physical server, creating new containers and virtual machines, and performing main operations on them. Unlike this guide, it does not contain detailed description of all the operations needed to install and set Virtuozzo to work.
* _Installing via PXE_. This guide provides information on installing Virtuozzo 7 over a network using a PXE (Preboot Execution Environment) server.
* _Virtuozzo 7 User's Guide_. This guide provides comprehensive information on Virtuozzo covering the necessary theoretical conceptions as well as all practical aspects of working with the product. The guide does not deal with the process of installing and configuring Virtuozzo systems.
* _Virtuozzo Storage Administrator's Guide_. This guide is intended for system administrators interested in deploying Virtuozzo storage in their networks.
* _Virtuozzo 7 Templates Management Guide_. This guide is meant to provide complete information on templates, an exclusive technology allowing you to efficiently deploy standard Linux applications in containers and greatly save the physical server resources (memory, disk space, and so on).
* _Virtuozzo 7 Command Line Reference Guide_. This guide is a complete reference on all Virtuozzo configuration files and command-line utilities.

Feedback
~~~~~~~~

If you spot a typo in this guide, or if you have an opinion about how to make this guide more helpful, you can share your comments and suggestions with us by completing a  documentation feedback form at http://www.odin.com/en/support/usersdoc/.

Preparing for Installation
--------------------------

This chapter provides the following information:

[options="compact"]
* hardware requirements for installing Virtuozzo
* software requirements for installing Virtuozzo
* network requirements for Virtuozzo
* ways to obtain Virtuozzo
* the process of making a bootable USB drive with Virtuozzo

Hardware Compatibility
~~~~~~~~~~~~~~~~~~~~~~

The system requirements slightly change depending on whether you are deploying Virtuozzo 7

[options="compact"]
* as a stand-alone installation (see <<_requirements_for_standalone_installations>>) or
* as part of a Virtuozzo storage cluster (see <<_requirements_for_servers_in_a_virtuozzo_storage_cluster>>)

Requirements for Standalone Installations
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

The hardware requirements for running Virtuozzo 7 as a standalone installation are as follows:

[options="compact"]
* x86-64 platform with Intel VT-x or AMD-V hardware virtualization support,
* CPU: 1.5 GHz or faster (a 64-bit processor is required for running x64 versions of guest operating systems),
* RAM: 2 GB or more,
* HDD: 100 GB or more,
* Network: an Ethernet network adapter and a valid IP address.

The actual number of virtual machines and containers you can run on a physical server and their performance depend on the resources they require. In general, the more resources your physical server has, the more virtual machines and containers you can run and the higher their performance.

Requirements for Servers in a Virtuozzo Storage Cluster
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

If you plan to deploy a Virtuozzo storage cluster, make sure your servers meet the requirements below.

Metadata Servers
++++++++++++++++

[options="compact"]
* Software: Virtuozzo 7
* RAM: 1 GB per each 100 TB of storage
* Disk space: 10 GB or more
* Network:
+
--
[options="compact"]
* 1 or more Ethernet adapters (1 Gb or faster)
* a static IP address for each Ethernet adapter
--

Chunk Servers
+++++++++++++

[options="compact"]
* Software: Virtuozzo 7
* RAM: 1 GB or more
* Disk space: chunk servers can export any amount of available local disk space to a Virtuozzo storage cluster
* Network: 1 or more Ethernet adapters (1 Gb or faster)

Clients
+++++++

[options="compact"]
* Software: Virtuozzo 7
* Network: 1 or more Ethernet adapters (1 Gb or faster)

There are no special requirements to the amount of RAM and disk space that must be available on a client, except for the general recommendations for running the Virtuozzo storage software.

System Limits
^^^^^^^^^^^^^

The table below lists the current hardware limits for Virtuozzo 7:

[options="header",cols="1,2,2"]
|====
|Hardware|Theoretical|Certified
|RAM|64 TB|256 GB
|CPU cores|128 hyperthreaded cores +
256 non-hyperthreaded cores	|32 hyperthreaded cores
|HDD|16 TB|16 TB
|====

Software Compatibility
~~~~~~~~~~~~~~~~~~~~~~

Virtuozzo is installed on a bare-metal server and does not need any operating system to function.

Network Requirements
~~~~~~~~~~~~~~~~~~~~

To connect to a physical server with Virtuozzo, you need to establish a wireless or wired network connection between this server and the remote computer. So, you must have a valid IP address for the physical server as well as know the default gateway, network mask, and DNS configuration.

Obtaining Virtuozzo 7 Distribution Set
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

You can use one of the following ways to obtain the Virtuozzo 7 distribution set:

[options="compact"]
* Download the ISO image of Virtuozzo 7 from the Odin website to your computer. In this case, you need to burn the downloaded ISO image to a DVD or to create a bootable USB drive before starting the installation.
* Contact an Odin sales representative and get a DVD with Virtuozzo 7.

Preparing for Installation from USB Storage Drives
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Virtuozzo can be installed from USB storage drives on physical servers with MBR or (U)EFI, given that the server allows booting from USB drives. You will need to make a bootable USB drive using the previously downloaded Virtuozzo distribution image. You will need:

[options="compact"]
* A 2 GB or more capacious USB drive.
* The Virtuozzo 7 distribution ISO image.

To make a bootable USB storage drive, use the `mkinst_flash` script. The script is located in the root directory of the Virtuozzo installation image and can be executed on any Linux machine or Mac. The installation procedure differs slightly depending on whether the server where you plan to install Virtuozzo has a traditional MBR or (U)EFI.

* To install Virtuozzo on a server with a traditional MBR, run this command:
+
[subs="quotes"]
----
*# ./mkinst_flash _&lt;distribution_image&gt;_ _&lt;destination_USB_drive&gt;_ --mbr*
----

* To install Virtuozzo on a server with (U)EFI, run this command:
+
[subs="quotes"]
----
*# ./mkinst_flash _&lt;distribution_image&gt;_ _&lt;destination_USB_drive&gt;_ --efi*
----

[NOTE]
[subs="quotes"]
====
*Note:* Running the script without the `--mbr` or `--efi` option will create a "hybrid" bootable drive suitable for both MBR and (U)EFI. However, it may not work on some specific firmware interfaces. In that case, create a bootable drive using an appropriate option as described above.
====

The following example demonstrates how to create a bootable USB drive mapped to `/dev/sdb` with the supplied `mkinst_flash` script:

[subs="quotes"]
----
*# ./mkinst_flash parallels-server-6.0.0-786-x86_64.iso /dev/sdb --efi*
----

The `--efi` option, if specified, tells the script to make a bootable drive for a (U)EFI system. During execution, the `mkinst_flash` script repartitions the USB drive and transfers the distribution files to its first partition. So if during installation you are asked for the location of the installation image, specify the first partition of the USB drive. For example, if the USB drive is mapped to `/dev/sdb`, specify `/dev/sdb1`.

[NOTE]
[subs="quotes"]
====
*Note:* To make a "hybrid" bootable USB drive on Windows, you can use the *Win32 Disk Imager* tool (http://sourceforge.net/projects/win32diskimager/).
====

Installing Virtuozzo 7
----------------------

This chapter provides detailed information on installing Virtuozzo 7 in different ways:

[options="compact"]
* in default graphical mode (recommended)
* in graphical mode with basic or framebuffer video driver
* via VNC (Virtual Network Computing)
 
Starting Installation
~~~~~~~~~~~~~~~~~~~~~

Virtuozzo can be installed from

[options="compact"]
* DVD discs
* USB drives (see <<_preparing_for_installation_from_usb_storage_drives>>)
* PXE servers (see the _Installation via PXE Server_ guide for information on installing Virtuozzo over the network)

[NOTE]
[subs="quotes"]
====
*Note:* Time synchronization via NTP is enabled by default.
====

To start the installation, do the following:

[options="compact"]
. Configure the server to boot from the chosen media (either a DVD disc or a USB drive).
. Boot the server from the chosen media and wait for the *Welcome* screen:

image::images/_welcomescreen.png[align="center"]

Choosing Installation Type
^^^^^^^^^^^^^^^^^^^^^^^^^^

You can install Virtuozzo 7 in one of the following modes:

[options="compact"]
* _Graphical_ (default, recommended): install Virtuozzo using the graphical installer.
* _Graphical with basic video driver_: install Virtuozzo using the graphical installer in a special mode. Choose this mode if the installer cannot load the correct driver for your video card.
* _Graphical with framebuffer video driver_ (available for EFI-based installations only): install Virtuozzo using the graphical installer in a special mode. Choose this mode in case of issues with the basic video driver mode.

Your further installation steps will differ depending on the chosen mode.

Enabling Forced Detection of SSDs
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Certain solid-state drives (SSDs) may not be autodetectable by the installer. This may result in issues when you create or join Virtuozzo storage clusters. To avoid this problem, you can force the installer to identify the required drives as SSDs by doing the following:

[options="compact"]
. On the installer welcome screen, choose the desired installation option.
. Press *Tab* to edit the chosen installation option.
. In the console prompt that appears, add the following parameter at the end of the installation command:
+
+ssd_hack=sd__<N>__[,...]+
+
where +_&lt;N&gt;_+ is the letter of the required SSD (see an example below).
+
image::images/pcs6.0installer-ssd_hack.png[align="center"]

. Press *Enter* to start installation.

The installer will identify the specified drives as SSDs.

Disabling RAID
^^^^^^^^^^^^^^

To install Virtuozzo on disks which were previously used in RAID setups, you may need to do the following:

. Disable RAID in BIOS to be able to boot from a single HDD.
. On the installer welcome screen, choose the desired installation option.
. Press *Tab* to edit the chosen installation option.
. In the console prompt that appears, add the `nodmraid` parameter at the end of the installation command:
+
image::images/pcs6.0installer-nodmraid.png[align="center"]

. Press *Enter* to start installation.

[NOTE]
[subs="quotes"]
====
*Warning:* Any RAID configurations you have will be ignored during the installation. Make sure you will not lose any data because of this.
====
 
Installing in Graphical Mode
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

To install in the graphical mode, choose the *Install or upgrade an existing system* option in the *Welcome* window and press *Enter*. In this mode, you use the graphical installer and specify only basic parameters to install Virtuozzo.

Reading and Accepting the License Agreement
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Read and accept the end-user license agreement. To accept the license agreement, click *Next*, and in the displayed window, click *Agree*.

Selecting the Keyboard Type
^^^^^^^^^^^^^^^^^^^^^^^^^^^

Select the keyboard layout to use for the installation and as the system default once the installation is complete.

image::images/_expertinstallation-selectingkeyboard.png[align="center"]

[NOTE]
[subs="quotes"]
====
*Note:* For installations from a USB drive, the screen where you can select the desired keyboard layout is shown before the *License Agreement* screen.
====

Defining Network Settings
^^^^^^^^^^^^^^^^^^^^^^^^^

Choose a hostname for your server. You can specify a hostname as a fully qualified domain name (+__&lt;hostname&gt;__.__&lt;domainname&gt;__+) or as a short name (+_&lt;hostname&gt;_+).

image::images/_installation-choosinghostname.png[align="center"]

On this screen, you may also need to configure your network settings for at least one network card. To do this:

. Click the *Configure Network* button.
. Select one of the network cards installed on the server.
. Click *Edit*.
+
image::images/_installation-configuringnetworksettings.png[align="center"]

. Do one of the following:
+
--
[options="compact"]
* Accept the network settings offered by the installer. View the default settings in the editing network card window, and if you are satisfied with them, click *Apply*; then click *Close*.
* Configure the network card settings. Click the necessary tabs in the editing network card window, and configure the settings to meet your demands. When you are done, click *Apply*; then click *Close*.
--

Click *Next* to continue with the installation.

Choosing the Installation Device
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Select the storage device to install Virtuozzo on.

image::images/_pcs_installation1.png[align="center"]

You can choose between two options:

[options="compact"]
* *Basic Storage Devices*: Perform a standalone installation of Virtuozzo 7 on a hard drive that is connected directly to your local system (local hard drive).
* *Virtuozzo storage*: Include the server in a Virtuozzo storage cluster. If you choose this option, you will need to specify a number of additional settings described in <<_configuring_for_use_with_virtuozzo_storage>>.
+
[NOTE]
[subs="quotes"]
====
*Notes:*

. Virtuozzo storage is a solution that transforms local hard drives into a highly protected enterprise-level storage (like SAN or NAS) with data replication, high-availability, and self-healing features. Using Virtuozzo storage, you can safely store and run virtual machines and containers, migrate them with zero downtime, provide high availability for your Virtuozzo installations, and much more. For more information on Virtuozzo storage, see the _Virtuozzo storage Administrator's Guide_.
. In a Virtuozzo storage cluster, all servers must have unique hostnames. So if you did not set a hostname for the server, click *Back* and specify one on the screen of defining network settings.
====

Configuring for Use with Virtuozzo Storage
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

If you choose to install on Virtuozzo storage, you see the following window:

image::images/_pcs_installation2.png[align="center"]

In this window, you can choose one of these options:

[options="compact"]
* *Join an existing Virtuozzo storage*. Choose this option to join the server to an existing Virtuozzo storage cluster. You can use this option if you already have set up at least one cluster in your network and want to make the server part of this cluster.
* *Create a new Virtuozzo storage*. Choose this option to create a Virtuozzo storage cluster from scratch. You can use this option if you do not have any clusters in your network or want to set up a separate cluster for this installation.

Depending on which option you choose, your further steps will slightly differ.

[NOTE]
[subs="quotes"]
====
*Note:* For detailed information on working with Virtuozzo storage clusters, consult the _Virtuozzo Storage Administrator's Guide_.
====

Creating a New Virtuozzo Storage Cluster
++++++++++++++++++++++++++++++++++++++++

If you choose to create a new Virtuozzo storage cluster, you see this window:

image::images/_pcs_installation3.png[align="center"]

Specify the parameters for your new Virtuozzo storage cluster. All parameters are described below.

*Main cluster parameters*

First, you need to assign a name for the cluster and set a password to access it.

[options="compact"]
* *Cluster name*. Specify a name for the cluster that will uniquely identify it among other clusters in your network. A cluster name must consist of the characters a-z, A-Z, 0-9, minus (-), underscore (_), and must not exceed 63 characters.
* *Security settings*. Click this button and specify a password to use for password-based authentication in your cluster.

image::images/instllation-pcssecurity.png[align="center"]

Password-based authentication enhances security, requiring each server to be authenticated before it can be included in the cluster. The password you specify is encrypted and saved to the +/etc/pstorage/clusters/__&lt;cluster_name&gt;__/auth_digest.key+ file on the server.

[NOTE]
[subs="quotes"]
====
*Note:* You need to authenticate a server only once. After that, you can configure it as an MDS server, chunk server, or a client. So if you later decide to configure the server where you are setting the first MDS server as a chunk server, no additional authentication will be required.
====

*Cluster Roles*

Each server in the cluster can play one or all of the following roles:

* *Metadata Server Role*. Specify whether the installer should configure your server to act as a metadata (MDS) server in the cluster. MDS servers are an essential part of any Virtuozzo storage cluster. They store metadata about chunk servers and control how files keeping the contents of virtual machines and containers are split into chunks and where these chunks are located.
+
When you create a new Virtuozzo storage cluster, the *Metadata Server Role* option is selected by default. To set up an MDS server, you need to specify an IP address to use for connecting to this server. You can type it manually in the *IP address* field or click the arrow at the end of the field and choose one from the list of IP addresses that were detected by the installer (it shows all IP addresses it could find for the server).
+
[NOTE]
[subs="quotes"]
====
*Note:* MDS servers must have static IP addresses assigned. If you are using DHCP, map an IP address to the MAC address of the MDS server.
====

* *Chunk Server Role*. Specify whether the installer should configure your server to act as a chunk server in the cluster. Chunk servers store the contents of virtual machines and containers in the form of fixed-size chunks and provide access to these chunks. All data chunks are replicated and the replicas are kept on different chunk servers to achieve high availability. If one of the chunk servers goes down, the other chunk servers will continue providing the data chunks that were stored on the failed server.
+
[NOTE]
[subs="quotes"]
====
*Warning:* Virtuozzo storage has redundancy built in, so you should avoid running Virtuozzo storage on redundant types of RAID like 1, 5, or 6 over local storage. In this case, a single write operation may affect a significant number of HDDs resulting in very poor performance. For example, for 3 Virtuozzo storage replicas and RAID5 on servers with 5 HDDs each, a single write operation may result in 15 I/O operations. For recommendations on optimal local storage configurations, consult the _Virtuozzo Storage Administrator's Guide_.
====
+
By default, the installer does the following:
+
--
* If your server has several disk drives, the installer will automatically configure each disk drive except system to act as a separate chunk server.
+
[NOTE]
[subs="quotes"]
====
*Note:* Creating chunk servers on system disks is not recommended as additional load from system/swap may reduce CS performance which may lead to overall cluster performance degradation. If you still want to create a CS on a system disk, click *Chunk Server settings* and check the *Create CS on system disk* box.
====

* If one or more SSD drives are available on the server, they will be set up to store chunk server write journals (each chunk server will get its own journal). By using SSD drives for write journaling, you can boost the performance of write operations in the cluster by up to 2 and more times. For more information on using SSD drives, consult the _Virtuozzo Storage Administrator's Guide_.
+
[NOTE]
[subs="quotes"]
====
*Note:* If one or more SSDs are not detected automatically, find out their drive letters (e.g., invoke the console by pressing *Ctrl+Alt+F2* and analyze `dmesg` output), reboot to the installer Welcome screen, and see <<_enabling_forced_detection_of_ssds>> for instructions.
====
--
+
To check the chunk server settings that will be applied to your disk drives, click the *Chunk Server settings* button.

* *Client Server Role*: Specify whether the installer should configure your server to act as a client in the cluster. Clients are computers with Virtuozzo 7 from where you run virtual machines and containers stored in your Virtuozzo storage cluster.
+
By default, the installer
+
--
* Enables High Availability support for the client and for all virtual machines and containers you will create on it. With High Availability turned on, if the client fails, all virtual machines and containers hosted on it will be automatically moved to a healthy server. For detailed information on High Availability, consult the _Virtuozzo 7 User's Guide_.
* If one or more SSD drives are available on the server, configures them to store a local cache of frequently accessed data. By having a local cache on an SSD drive, you can increase the overall cluster performance by up to 10 and more times. For more information on using SSD drives, consult the _Virtuozzo Storage Administrator's Guide_.
+
[NOTE]
[subs="quotes"]
====
*Note:*  If one or more SSDs are not detected automatically, find out their drive letters (e.g., invoke the console by pressing *Ctrl+Alt+F2* and analyze dmesg output), reboot to the installer Welcome screen, and see <<_enabling_forced_detection_of_ssds>> for instructions.
====
--
+
Using the *Client settings* button, you can check whether the support for using SSD drives to store a local cache is enabled.

When you are done, click *Next*.

Joining an Existing Virtuozzo Storage Cluster
+++++++++++++++++++++++++++++++++++++++++++++

If you select the *Join an existing Virtuozzo storage* option and click *Next*, you will see this window:

image::images/_pcs_installation4.png[align="center"]

Specify the parameters to join your new server to the cluster:

. *Cluster name*: Specify the name of the Virtuozzo storage you want to join your server to.
+
In most cases, the installer automatically detects all Virtuozzo storage clusters in your network and displays their names as a list box to the right of the *Cluster name* field. If the installer cannot find any cluster, it shows a warning, and you need to manually type the cluster name in the provided field.

. *Security settings*. Click the button and specify the password to authenticate your new server in the cluster. Type the password you specified when creating the cluster and press *Enter*.

. *Metadata Server Role*. Specify whether the installer should configure your server to act as a metadata (MDS) server in the cluster. MDS servers are an essential part of any Virtuozzo storage cluster. They store metadata about chunk servers and control how files keeping the contents of virtual machines and containers are split into chunks and where these chunks are located.
+
When you create a new Virtuozzo storage cluster, the *Metadata Server Role* option is selected by default. To set up an MDS server, you need to specify an IP address to use for connecting to this server. You can type it manually in the *IP address* field or click the arrow at the end of the field and choose one from the list of IP addresses that were detected by the installer (it shows all IP addresses it could find for the server).
+
[NOTE]
[subs="quotes"]
====
*Note:* MDS servers must have static IP addresses assigned. If you are using DHCP, map an IP address to the MAC address of the MDS server.
====

. *Chunk Server Role*. Specify whether the installer should configure your server to act as a chunk server in the cluster. Chunk servers store the contents of virtual machines and containers in the form of fixed-size chunks and provide access to these chunks. All data chunks are replicated and the replicas are kept on different chunk servers to achieve high availability. If one of the chunk servers goes down, the other chunk servers will continue providing the data chunks that were stored on the failed server.
+
[NOTE]
[subs="quotes"]
====
*Warning:* Virtuozzo storage has redundancy built in, so you should avoid running Virtuozzo storage on redundant types of RAID like 1, 5, or 6 over local storage. In this case, a single write operation may affect a significant number of HDDs resulting in very poor performance. For example, for 3 Virtuozzo storage replicas and RAID5 on servers with 5 HDDs each, a single write operation may result in 15 I/O operations. For recommendations on optimal local storage configurations, consult the _Virtuozzo Storage Administrator's Guide_.
====
+
By default, the installer does the following:
+
--
* If your server has several disk drives, the installer will automatically configure each disk drive to act as a separate chunk server.
* If one or more SSD drives are available on the server, they will be set up to store chunk server write journals (each chunk server will get its own journal). By using SSD drives for write journaling, you can boost the performance of write operations in the cluster by up to 2 and more times. For more information on using SSD drives, consult the _Virtuozzo Storage Administrator's Guide_.
+
[NOTE]
[subs="quotes"]
====
*Note:* If one or more SSDs are not detected automatically, find out their drive letters (e.g., invoke the console by pressing *Ctrl+Alt+F2* and analyze dmesg output), reboot to the installer Welcome screen, and see <<_enabling_forced_detection_of_ssds>> for instructions.
====
--
+
To check the chunk server settings that will be applied to your disk drives, click the _Chunk Server settings_ button.

. *Client Server Role*: Specify whether the installer should configure your server to act as a client in the cluster. Clients are computers with Virtuozzo 7 from where you run virtual machines and containers stored in your Virtuozzo storage cluster.
+
By default, the installer
+
--
* Enables High Availability support for the client and for all virtual machines and containers you will create on it. With High Availability turned on, if the client fails, all virtual machines and containers hosted on it will be automatically moved to a healthy server. For detailed information on High Availability, consult the _Virtuozzo 7 User's Guide_.
* If one or more SSD drives are available on the server, configures them to store a local cache of frequently accessed data. By having a local cache on an SSD drive, you can increase the overall cluster performance by up to 10 and more times. For more information on using SSD drives, consult the _Virtuozzo Storage Administrator's Guide_.
+
[NOTE]
[subs="quotes"]
====
*Note:*  If one or more SSDs are not detected automatically, find out their drive letters (e.g., invoke the console by pressing *Ctrl+Alt+F2* and analyze dmesg output), reboot to the installer Welcome screen, and see <<_enabling_forced_detection_of_ssds>> for instructions.
====
--
+
Using the *Client settings* button, you can check whether the support for using SSD drives to store a local cache is enabled.

When you are done, click *Next*.

Entering the License Key
^^^^^^^^^^^^^^^^^^^^^^^^

Enter the Virtuozzo and Virtuozzo storage license keys:

[options="compact"]
* _Virtuozzo license key_. Every physical server must have its own license key installed. You need to install a license key to use Virtuozzo on your server.
* _Virtuozzo storage license key_. You need to install a separate license key for Virtuozzo storage to use its functionality. If you are performing a standalone installation of Virtuozzo, the field for entering a Virtuozzo storage key is not displayed.

image::images/_enterlicense.png[align="center"]

Type the license keys in the fields provided, and click *Next*. You can skip this step and install the keys later. However, if you do not specify the key for Virtuozzo, you will not be able to install Virtual Automation and its components along with Virtuozzo. For more information about Virtual Automation, see <<_installing_virtual_automation>>.

Defining Time Zone Settings
^^^^^^^^^^^^^^^^^^^^^^^^^^^

Specify your time zone settings.

image::images/_definetimesettings.png[align="center"]

To set your time zone, either select the city nearest to your physical location on the drop-down menu or click a spot on the interactive map to zoom in to it. You can also select the *System clock uses UTC* check box to set your system to UTC (Universal Time Coordinated), which makes it automatically switch between normal and daylight saving time.

Setting a Password
^^^^^^^^^^^^^^^^^^

Specify a password for the root account.

image::images/_installation-enteringrootpassword.png[align="center"]

You will need to log in to the physical server as root to manage virtual machines and containers.

Partitioning the Hard Drive
^^^^^^^^^^^^^^^^^^^^^^^^^^^

The *Partitioning* window allows you to choose the way of partitioning your server.

image::images/_formattingpartitions.png[align="center"]

Do one of the following:

[options="compact"]
* Select the *Use All Space* radio button to create the default layout on the server. If you do not feel comfortable with partitioning servers, you are recommended to select this option and let the installer automatically partition your system. For details, see <<_creating_the_default_layout>>.
* Select the *Create Custom Layout* radio button to manually partition your disk drive. Detailed information on how you can do it is given in <<_creating_a_custom_layout>>.

Creating the Default Layout
+++++++++++++++++++++++++++

The default partitioning scheme differs depending on whether you use Virtuozzo with a local storage or Virtuozzo storage.

*Using with a Local Storage*

If you are using Virtuozzo with a local storage, the installer creates the following partitions on your system:

[options="header",cols="1a,3"]
|====
|Partition|Description

|`/boot`|Boot partition containing boot files for Virtuozzo.
|`/`|Root partition containing Virtuozzo files.
|`/vz`|Partition where all virtual machines and containers will be located.
|`swap`|Paging partition for Virtuozzo.
|====

*Using with a Virtuozzo Storage*

If you are using Virtuozzo with a Virtuozzo storage, the installer creates the following:

[options="header",cols="1a,3a"]
|====
|Partition|Description

|`/boot`|Boot partition containing boot files for Virtuozzo.
|`/`|Root partition containing Virtuozzo files.
|`/vz`|Partition for storing OS and application template files.
|`swap`|Paging partition for Virtuozzo.
|`/pstorage`|The directory for Virtuozzo storage data. In it, the installer may create the following subdirectories, depending on the options you choose:

[options="compact"]
* +__&lt;cluster_name&gt;__-cs[__&lt;N&gt;__]+: Mount point(s) for the chunk server(s). Created if the Node will host chunk servers.
* +__&lt;cluster_name&gt;__-mds+: Stores metadata about Virtuozzo storage data. Created if the Node will host an MDS server.
* +_&lt;cluster_name&gt;_+: Mount point for the Virtuozzo storage cluster. Created if the Node will serve as a client.
|==== 

Creating a Custom Layout
++++++++++++++++++++++++

If you choose to create a custom layout (by selecting the *Create custom layout* radio button while specifying partition settings and clicking *Next*), the following window appears:

image::images/34411.png[align="center"]

The process of partitioning your system is similar to that used to partition servers with the Disk Druid partitioning tool which comes with most Linux distributions. You can use the provided buttons (*Create*, *Edit*, and so on) to create and configure your partitions. The partitions you need to create differ depending on whether you use Virtuozzo with a local storage or with a Virtuozzo storage.

*Using with a Local Storage*

If you are using Virtuozzo with a local storage, create the following partitions on your system:

[options="header",cols="1a,3a"]
|====
|Partition|Description

|`/boot`|Boot partition containing boot files for Virtuozzo. Allocate 500 MB.
|`/`|Root partition containing Virtuozzo system files. Allocate at least 12 GB.
|`swap`|Paging partition for Virtuozzo. For details on how much disk space to allocate to swap, see *Creating the Paging Partition* below.
|`/vz`|Partition where all containers and virtual machines will be stored. Allocate all the remaining disk space to this partition (at least 88 GB).
|====

*Using with a Virtuozzo Storage*

If you are using Virtuozzo with a Virtuozzo storage, create the following partitions:

[options="header",cols="1a,2a"]
|====
|Partition|Description

|`/boot`|Boot partition for Virtuozzo boot files. Allocate 500 MB.
|`/`|Root partition for Virtuozzo files. Allocate 20-30 GB.
|`/vz`|Partition for OS and application template files. Allocate 30-40 GB.
|`swap`|Paging partition for Virtuozzo. For details on how much disk space to allocate to swap, see *Creating the Paging Partition* below.
|+/pstorage/__&lt;cluster_name&gt;__-cs[__&lt;N&gt;__]+|Chunk server partition. Allocate at least 100GB. Create only one CS partition per physical disk. When adding CS partitions, choose a mount point for each in the corresponding column.
|====

*Creating the Paging Partition*

Use the following guidelines when deciding on how much disk space to allocate to swap:

[options="header"]
|====
|RAM|swap
|up to 4 GB|2 GB
|4-16 GB|4 GB
|16-64 GB|8 GB
|64-256 GB|16 GB
|256-512 GB|32 GB
|====
 
Choosing the Device
^^^^^^^^^^^^^^^^^^^

Choose the storage device to install Virtuozzo and the boot loader on. This screen is displayed only if your system contains more than one storage device.

image::images/_expertinstallation-choosingstorage.png[align="center"]

To choose a device, select it in the *Data Storage Devices* table, and then click the right arrow button to move the device to the *Install Target Devices* table. If you move more than one device to the *Install Target Devices* table, you will also need to choose the device to install the boot loader to. To do this, click the radio button next to the desired device.

Note that the devices you leave in the *Data Storage Devices* table will be attached to the file system as data storages but will not be partitioned or formatted.

Installing Virtual Automation
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Choose the Virtual Automation components to install on your server. This screen is displayed only if you entered the license in one of the previous steps and your license provides support for Virtual Automation.

image::images/_installation-installingpva.png[align="center"]

Do one of the following:

* Clear the *Install VA Agent for Virtuozzo* and *Install VA Management Node* check boxes, and click *Next* if you do not want to use Virtual Automation for managing your server and virtual machines and containers.
* Leave the *Install VA Agent for Virtuozzo* and *Install VA Management Node* check boxes selected to set up the Virtual Automation application and its components on the server. Using Virtual Automation, you can connect to the server and manage virtual machines and containers with your favorite browser.
+
If you leave the check boxes selected, you will need to specify a valid and unused IP address accessible from the Internet and a hostname (optional) for VA management node. This Virtual Automation component will be downloaded to and installed in a container, so make sure this container with the IP you have chosen will have Internet access. Once the VA management node installation is complete, you can log in to Virtual Automation by visiting the chosen IP address or hostname and using the username root and the password you specified in the previous step.
+
When the check boxes are selected, the installer performs the following operations after you restart the server:
+
--
[options="compact"]
. Downloads the installation packages for Virtual Automation from the Odin website. Notice that the download process may take some time, depending on the speed of your Internet connection.
. Sets up Virtual Automation and its components. The installation is automatically initiated once the installation packages are downloaded and runs without your interaction.
--

When you are done, click *Next* to start installing Virtuozzo.

[NOTE]
[subs="quotes"]
====
*Notes:* 

. Your server and the container must be connected to the Internet to download the Virtual Automation installation packages from the remote repository. 
. You can use Virtual Automation to manage servers only if your license allows you to do so. If the license does not support using Virtual Automation, the VA components screen is not displayed. In this case, you must first upgrade your license and then install the Virtual Automation application manually. For more information, see <<_installing_virtual_automation_manually>>.
. For more information on setting up and logging in to Virtual Automation, see <<_using_virtual_automation>>.
====

Installing Updates
^^^^^^^^^^^^^^^^^^

To save time, you can also download and install product updates from the official repository during Virtuozzo installation. To do this, click *Yes* in the alert window that is shown after the installation has started but before any packages are installed:

image::images/installation-updates.png[align="center"]

After you have made your choice, the installation will continue.

Finishing the Installation
^^^^^^^^^^^^^^^^^^^^^^^^^^

Once the installation is complete, the *Congratulations* window appears. Click *Reboot* to restart the server and boot into Virtuozzo.

The *Eject the installation DVD* option, when selected, automatically removes the Virtuozzo installation disc from your DVD-ROM drive before booting the system.

[NOTE]
[subs="quotes"]
====
*Note:* If you are installing Virtuozzo from a USB drive, remove the drive manually before restarting the server.
====

Installing with Basic or Framebuffer Video Driver
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

If the installer cannot load the correct driver for your video card, you can try to install Virtuozzo in the _graphical mode with basic or framebuffer video driver_. The latter is available for EFI-based installations only. To install in one of these modes:

[options="compact"]
* Choose the *Install system with basic video driver* option on the *Welcome* screen, and press *Enter*.
* Choose the *Install system with framebuffer video driver* option on the *Welcome* screen, and press *Enter*.

Installing Virtuozzo in these modes does not differ from installing it in the default graphical mode. Consult <<_installing_in_graphical_mode>> for information on specific installation steps.

Installing via VNC
~~~~~~~~~~~~~~~~~~

To install Virtuozzo in the VNC (Virtual Network Computing) mode:

. In the *Welcome* screen, press *Esc*.
. At the boot prompt that appears, type `linux vnc`, and press *Enter*.
. Wait until the installer launches the VNC server and displays the information on how to connect to the server via a VNC client.
. On the computer you plan to use for installing Virtuozzo, run your favorite VNC client.
. Connect to the server using the information provided by the installer in Step 3.
. Follow the on-screen instructions to install Virtuozzo in the graphical mode. For details, see <<_installing_in_graphical_mode>>.

[NOTE]
[subs="quotes"]
====
*Note:* You can also specify the standard vnc command in a kickstart file to view the graphical installation of Virtuozzo remotely via VNC. For details on this command, see the description of kickstart options in the _Red Hat Linux Enterprise Installation Guide_.
====

Configuring Ports
~~~~~~~~~~~~~~~~~

This section lists the ports that need to be opened for your server to operate properly. The set of ports differs depending on your system configuration:

[options="compact"]
* If the server does not participate in a Virtuozzo storage cluster and does not use Virtual Automation, see <<_servers_without_virtual_automation>> for information on ports used by Virtuozzo.
* If the server is part of a Virtuozzo storage cluster, see <<_servers_in_virtuozzo_storage_clusters>> for information on ports used by the cluster.
* If the Virtual Automation application is installed on the server, see <<_servers_with_virtual_automation>> for information on ports used by this application.
* If you plan to set up a VA management node, see <<_va_management_node>> for information on ports required by this component.

Servers without Virtual Automation
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

The table below lists the ports for servers that do not participate in Virtuozzo storage clusters and do not use the Virtual Automation application. `I` in the *Description* column signals that the port should be opened for incoming traffic and `O`, for outgoing traffic.

[options="header",cols="1a,3a"]
|====
|Port|Description

|22|(IO) Used for secure logins via SSH.
|80|(IO) Used for HTTP connections, e.g., to download Virtuozzo updates and EZ templates from remote repositories.
|21|(O) Used to connect to the Debian repository to cache Debian EZ templates.
|443|(O) Used to send problem reports to the Odin support team.
|5224|(O) Used to connect to the Key Administrator server to update Virtuozzo lease licenses.
|64000|(IO) Used for remote connections to the Odin dispatcher via Odin Automation for Cloud Infrastructure.
|1621, 1622|(O) Used to migrate containers to virtual machines on servers that run Virtuozzo hypervisor-based solutions.
|67|Used to support host-only adapters in virtual machines. Virtuozzo does not use port 67 for any external connections.
|+_&lt;RPC ports&gt;_+|Used by various RPC services (e.g., to support NFS shares). Port numbers may differ from system to system. To learn what RPC services are registered on your server and what ports they are using, run this command:

[subs="quotes"]
----
*# rpcinfo -p localhost*
----
|647, 847|Reserved by the Linux `portreserve` program for the DHCP server, if you use one.
|====

You may also need to additionally open ports used to connect to remote yum repositories. Though most of the repositories can be accessed via HTTP, some may require access via HTTPS or FTP. To check what repositories are currently configured for your system and what protocols are used to connect to them, run the following commands and examine their output:

[subs="quotes"]
----
*# yum repolist -v | egrep -e &apos;baseurl|mirrors&apos;*
*# curl http://repo.cloudlinux.com/psbm/mirrorlists/psbm6-os.mirrorlist*
----

Servers in Virtuozzo Storage Clusters
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

A Virtuozzo storage cluster requires the following ports to be open, in addition to the ports listed in <<_servers_without_virtual_automation>>:

[options="header",cols="1a,3"]
|====
|Port|Description

2+<|*MDS Servers*
|2510|(IO) Used for communication between MDS servers.
|2511|(IO) Used for communication with chunks servers and clients.
2+<|*Chunk Servers*
|2511|(O) Used for communication with MDS servers.
|+_&lt;random_port&gt;_+|(I) Used for communication with clients. The chunk server management service automatically binds to any available port. You can also manually assign the service to a specific port.
2+<s|*Clients*
|2511|(O) Used for communication with MDS servers.
|+_&lt;random_port&gt;_+|(O) Used for communication with chunk servers. The client management service automatically binds to any available port. You can also manually assign the service to a specific port.
|==== 

Servers with Virtual Automation
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Servers running Virtual Automation must have the following ports open, in addition to the ports listed in <<_servers_without_virtual_automation>>:

[options="header",cols="1,3"]
|====
|Port|Description

|4643, 8443|(I) Used to connect to virtual machines and containers via the Power Panel and Plesk Panel applications, respectively.
|22, 64000|(IO) Used by Virtual Automation for backing up and migrating virtual machines and containers.
|25|(I) Used to send email notifications to users via the SMTP protocol.
|4646|(I) Used for communication with the server via the Agent SOAP interface.
|8443, 8880|(I) Used for integration between Plesk Control Panel and Power Panel.
|4433, 4435|(I) Used for non-encrypted connections to the VA Agent.
|4434|(I) Used for encrypted SSL connections to the VA Agent.
|4534|(I) Used for encrypted SSL XML connections to the VA Agent.
|4649|(I) Used for managing virtual machines and containers with the offline management feature enabled via the VNC protocol.
|====
 
VA management node
^^^^^^^^^^^^^^^^^^

If you plan to deploy a VA management node, make sure the following ports are opened on this node:

[options="header",cols="1,3"]
|====
|Port|Description

|22|(IO) Used for secure logins via SSH.
|4533|(I) Used for non-encrypted TCP connections to the VA management node.
|4534|(I) Used for encrypted SSL connections to the VA management node.
|4648|(I) Used to connect to the VA Control Panel.
|80, 443|(I) Used for redirects to the VA Control Panel.
|====

Exploring Additional Installation Options
-----------------------------------------

This chapter describes how to

[options="compact"]
* create software RAIDs for systems with Virtuozzo
* boot into rescue mode
* run Virtuozzo in virtual machines
 
Creating Software RAIDs
~~~~~~~~~~~~~~~~~~~~~~~

A software RAID consists of two or more physical hard disks combined to act as a single logical unit. Software RAIDs are created using special software and are meant for improving the disk performance and providing fault tolerance against disk errors.

You can create software RAIDs when installing Virtuozzo on your server. To do this, select the *Create custom layout* radio button in the *Partitioning* window, and click *Next*. The main partitioning window appears:

image::images/_raidinstallation-mainwindow.png[align="center"]

The process is similar to creating software RAIDs in most modern Linux distributions (e.g., Red Hat Enterprise Linux or CentOS) and includes the following stages:

[options="compact"]
. Making software RAID partitions (see <<_making_software_raid_partitions>>).
. Creating RAID arrays (or devices) from the newly made software RAID partitions (see <<_creating_raid_devices>>).

This section describes how to create a software RAID for the /vz partition when running the Virtuozzo installer in the graphical mode. However, you can easily adapt the procedures shown here to create software RAIDs for other partitions (e.g., root) in both the graphical and text modes.

Making Software RAID Partitions
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

In the first step, you need to create two or more identical software RAID partitions for the `/vz` partition. These partitions will then be used as the basis for a RAID array.

To create a software RAID partition:

.  Click the *Create* button on the *Please Select a Device* screen. The *Create Partition* dialog box appears.
+
image::images/_raidinstallation-createraid.png[align="center"]
. Select the *RAID Partition* radio button, and click *Create*.
. Set the following options:
+
--
[options="compact"]
.. In the *Allowable Drives* section, select the check box of the drive you want to use for the RAID. Make sure the check boxes of all the other drives are cleared. This is necessary because a software RAID partition can be situated on one disk drive only.
.. In the *Size* field, specify the size for the `/vz` partition. The `/vz` partition is intended to store all virtual machines and containers data and  should occupy as much disk space as possible.
.. Select *Force to be a primary partition* if you want to make the `/vz` partition a primary partition.
--
+
image::images/_raidinstallation-addpartition.png[align="center"]
. Click *OK*. After a while, the newly created software RAID partition should appear in the main partitioning window.

Repeat the steps above to create other software RAID partitions for the `/vz` partition. Their number can differ depending on the RAID configuration you want to implement. For example, if you are going to deploy the RAID 1 configuration with two mirrored hard drives, you need to create one more software RAID partition. Once you create it, your window should look like the following:

image::images/_raidinstallation-deviceparameters.png[align="center"]

Creating RAID Devices
^^^^^^^^^^^^^^^^^^^^^

Now that you have created the necessary RAID partitions for the `/vz` partition, you can make a RAID array on their basis. To do this:

. On the *Please Select a Device* screen, click the *Create* button.
. On the *Create Storage* screen, select the *RAID Device* radio button, and click *Next*.
+
image::images/_raidinstallation-makingraiddevice.png[align="center"]
. In the *Make RAID Device* dialog, set the following parameters for the RAID device:
+
--
[options="compact"]
.. Specify a mount point in the *Mount Point* field. In our case, the mount point should be `/vz`.
.. Set the RAID file system type in the *File System Type* field to `ext4`.
.. Select a name for the RAID array in the *RAID Device* field.
.. Choose the RAID level in the *RAID Level* field. You can choose any of the RAID levels available on the drop-down menu.
.. The *RAID Members* section lists all your software RAID partitions. Select the check boxes next to the RAID partitions you created for the `/vz` partition.
.. Specify the number of spare partitions in the *Number of spares* field. Spare partitions can be configured in RAID 1 and RAID 5 implementations only.
--
+
When you are done, click *OK*. The created RAID array appears in the *Devices* column under *RAID Devices*.
+
image::images/_raidinstallation-viewingraiddevices.png[align="center"]

For more information on RAIDs, see https://raid.wiki.kernel.org/index.php/Linux_Raid.

Booting into Rescue Mode
~~~~~~~~~~~~~~~~~~~~~~~~

If you experience a problem with your system, you can boot into the rescue mode to troubleshoot your problem. Once you are in the rescue mode, your Virtuozzo installation is mounted under `/mnt/sysimage`. You can go to this directory and make the necessary changes to your system.

To enter the rescue mode, do the following:

. Boot your system from a Virtuozzo DVD or USB drive.
. In the *Welcome* screen, choose the *Rescue* installed system option, and press *Enter*.
. Choose the language to use in the rescue mode.
+
image::images/_rescuemode-choosinglanguage.png[align="center"]
. Choose the keyboard type.
. Choose the Virtuozzo distribution media.
. In the *Setup Networking* window, decide whether or not to start the network devices installed on the server.
+
image::images/_startingnetworkinterfaces.png[align="center"]
. If you choose to start your network devices, you are prompted to configure their settings:
+
--
[options="compact"]
.. Choose the network card to configure.
.. Configure the network settings.
--
+
image::images/_rescuemode-configuingnetworkcardsettings.png[align="center"]
. The *Rescue* window informs you of what will be done in the rescue mode. Read the information carefully before proceeding. You can choose one of the following options:
+
--
[options="compact"]
* *Continue*. Choose this option to mount your file system in read and write mode under `/mnt/sysimage`.
* *Read-Only*. Choose this option to mount your file system in read-only mode under `/mnt/sysimage`.
* *Skip*. Choose this option if your file system cannot be mounted; for example, when it is corrupted.
* *Advanced*. Choose this option to activate SAN devices.
--
+
image::images/_rescuemode-instructions.png[align="center"]

. Once your file system is in the rescue mode, you are presented with the *Rescue* window informing you of this fact and providing further instructions on working in this mode. Read the instructions carefully, and press *Enter*.
. In a prompt that appears, run this command to change to the root partition of your file system:
+
[subs="quotes"]
----
*# chroot /mnt/sysimage*
----
+
Now you can run commands and try to fix the problem you are experiencing.
+
[NOTE]
[subs="quotes"]
====
*Note:* If you choose the *Skip* option, you can try to manually mount your file system using the `mount` utility.
====

. After you fix the problem, run the `exit` command to exit the `chroot` environment, and restart the system.

Running Virtuozzo in Virtual Machines
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Starting with version 5, you can install Virtuozzo in virtual machines. Doing so may prove useful if you want to evaluate the product but do not have a spare physical server.

To run virtual machines with Virtuozzo 7, a physical server must have one of the following architectures:

[options="compact"]
* Intel with VT-x and EPT,
* AMD with AMD-V and RVI.

Recommended Virtual Machine Configuration
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

A virtual machine is best optimized for use with Virtuozzo 7 if it has the following configuration:

[options="compact"]
* CPU: 2 or more virtual CPUs
* RAM: 2 GB or more
* HDD: 40 GB or more on a plain hard disk

Installing Virtuozzo in a virtual machine does not differ from installing it on a standalone server.

Restrictions and Peculiarities
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

When using Virtuozzo in a virtualized environment, keep in mind the following restrictions and specifics:

[options="compact"]
* Running Virtuozzo in a virtual machine is intended for evaluation purposes only. You are not recommended to use such installations in production.
* If you change the configuration of a virtual machine where Virtuozzo is installed, you may need to reactivate the product.
* When you start a virtual machine with Virtuozzo, VMware Fusion may warn you that it requires full access to the network traffic. Ignore this message, and proceed with booting the virtual machine.
* To run in a virtualized Virtuozzo environment, a virtual machine must have Virtuozzo Tools installed.
* Virtual machines may run only 32-bit operating systems and have only one CPU.

Starting to Work in Virtuozzo 7
-------------------------------

After you restart the server, you will see a screen providing instructions on how to start working in Virtuozzo 7.

You can manage Virtuozzo using these tools:

[options="compact"]
* Command-line utilities (see <<_using_cli>>)
* Virtual Automation (see <<_using_virtual_automation>>)

Detailed information on both tools is given in the following sections.

Using CLI
~~~~~~~~~

Virtuozzo provides a set of utilities that allow you to manage irtual machines and containers both locally and remotely.

Connecting to Virtuozzo Locally
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

To manage your virtual machines and containers locally, i.e. from the same server where Virtuozzo is installed, log in to the server by typing the `root` username and the password you provided when installing Virtuozzo at the bottom of the welcome screen.

After you have successfully logged in to the server, you will see a command prompt and can start creating and managing your virtual machines and containers using command line utilities.

Connecting to Virtuozzo Remotely
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

To connect to Virtuozzo remotely, use the IP address or hostname indicated on the server's screen. For example, you can use a Secure Shell client to connect to your server. When logging in to the server, use the `root` user name and the password you provided when installing Virtuozzo.

Using Virtual Automation
~~~~~~~~~~~~~~~~~~~~~~~~

Virtual Automation is a flexible and easy-to-use administration tool for managing servers with Virtuozzo and virtual machines and containers residing on these servers. Once you set up Virtual Automation, you can use it to connect to your Parallel servers with a standard web browser on any platform.

Virtual Automation includes the following components:

[options="compact"]
* _VA management server_ (or _master server_ or _management node_). A server (either physical or virtual) that ensures the communication between the server with Virtuozzo (known as slave server) and the Virtual Automation application. The master server keeps a database with the information about all registered slave servers.
* _Control center_. A front-end to the Virtual Automation application. You see control center in the browser window when you log it to the VA management server using Virtual Automation.
* _VA Agent_. A special agent installed on a slave server and ensuring the interaction between the slave server and the master server. Without this component, you cannot register a slave server the VA management server.
* _Slave Server_. A server running the Virtuozzo software and hosting a number of virtual machines and containers. You use Control Center to connect to the slave server to manage your virtual machines and containers.
* _Power Panel_. A tool installed on the slave server and used for managing particular virtual machines and containers by their end users.

Graphically, a typical system with Virtual Automation can be represented as follows.

image::images/pvascheme.png[align="center"]

Setting Up Virtual Automation
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Virtual Automation is automatically set up on your server during the Virtuozzo installation if you select the *Install VA Agent for Virtuozzo* and *Install VA management node* options in the Virtuozzo installer. During the setup procedure, the installer performs the following operations:

. Installs the VA Agent component, including Power Panel, on the server. After that, the server starts acting as the slave server.
. Creates a special container on the server and installs the VA management server and Control Center components inside the container. Once the container is created and the components are installed, the container starts acting as the master server.
+
The VA Management Server and Control Center components cannot be installed directly on a server with Virtuozzo. Instead, a special container is automatically created during the Virtuozzo installation where these components are installed. Once the setup is complete, you can access the container by the IP address you entered in the step of specifying VA parameters in the installer.

Installing Virtual Automation Manually
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

During the Virtuozzo installation, the Virtual Automation application is not installed on the server in the following cases:

[options="compact"]
* You did not enter a product key.
* Your product key does not allow you to use Virtual Automation.
* You had no Internet connection when installing Virtuozzo.

Later on, if you make up your mind to use Virtual Automation for managing servers and their virtual machines and containers, you can install this application manually by doing the following:

. Obtain the appropriate product key from Odin. This step is required only if your current key does not support using Virtual Automation.
. Install the product key on the server using the `vzlicload` utility. For information on installing product keys using this tool, see the _Virtuozzo 7 User's Guide_.
. Once the license is installed, create the `pva_opt.cfg file`, open it for editing, and specify the following options:
+
--
* `PVA_AGENT=1` if you want to install the VA Agent components or `PVA_AGENT=0` if you do not want to.
* `PVA_MN=1` if you want to install the VA management server and Control Center components or `PVA_MN=0` if you do not want to.
* +PASSWD="__XXXXXX__"+ where +_XXXXXX_+ is the root password on the server (set during the Virtuozzo installation). This option is mandatory if you choose to install VA management server and Control Center components.
* +PVA_IP="__X.X.X.X__"+ where +_X.X.X.X_+ is the IP address to be assigned to the management node. You will then use this IP address to log in to the management node. This option is mandatory if you choose to install VA management server and Control Center components.
+
[NOTE]
[subs="quotes"]
====
*Note:* The management node must have an active Internet connection to download the installation files from the remote repository.
====
* +PVA_HOSTNAME="__&lt;hostname&gt;__"+ where +_&lt;hostname&gt;_+ is the hostname to be assigned to the management node. This option is mandatory if you choose to install VA management server and Control Center components
--
. Make sure the server is connected to the Internet.
. In a terminal, change to the directory where the `pva_opt.cfg` file is located, and run this command:
+
[subs="quotes"]
----
*# /usr/libexec/pva-setup.sh --install pva_opt.cfg*
----

Connecting to a Server
^^^^^^^^^^^^^^^^^^^^^^

To connect to a server using Virtual Automation, do the following:

. On any computer, open your favorite Web browser.
. Make sure that the computer can access the VA management node over the network.
. Type the IP address or hostname of the container acting as the master server in the browser window.
. Log in to the container with root credentials (that is, the root user name and the password you entered during the Virtuozzo installation).

[NOTE]
[subs="quotes"]
====
*Note:* For more information on using Virtual Automation for managing servers with Virtuozzo, consult the _Virtual Automation Administrator's Guide_ available on the Odin website.
====
